<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jam.file.mapper.FileAssetMapper">

	<insert id="insertFileAsset">
		INSERT INTO file_asset
			(file_id, post_id, post_type, file_key, file_name, file_type, file_size, created_at)
		VALUES
			(seq_file_asset.NEXTVAL, #{post_id}, #{post_type}, #{file_key}, #{file_name}, #{file_type}, #{file_size}, sysdate)
	</insert>
	
	<select id="getFilesByPost" parameterType="file" resultType="file">
		SELECT file_id, file_name, file_key
		FROM file_asset
		WHERE post_id = #{post_id} AND post_type = #{post_type}
	</select>
	
	<delete id="deleteFiles" parameterType="list">
		DELETE FROM file_asset
		WHERE file_id IN
		<foreach collection="list" item="f" open="(" separator="," close=")">
			#{f.file_id}
		</foreach>
	</delete>
	
	<select id="getFileMetaByFileId" parameterType="Long" resultType="file">
		SELECT file_key, file_name
		FROM file_asset
		WHERE file_id = #{file_id}
	</select>
	
	<delete id="deleteFilesByKeys" parameterType="String">
		DELETE FROM file_asset WHERE file_key = #{key}
	</delete>
</mapper>