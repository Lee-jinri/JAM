<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jam.global.mapper.FileAccessMapper">
	<select id="existsFileAccess" parameterType="java.util.Map" resultType="int">	
		SELECT CASE WHEN EXISTS (
			SELECT 1
			FROM file_asset f
			WHERE f.file_id = #{file_id}
				AND (
					(f.post_type = 'APPLICATION' AND EXISTS (
						SELECT 1
						FROM application a
						WHERE a.application_id = f.post_id
							AND (a.user_id = #{user_id} OR a.company_id = #{user_id})
					))
					<!-- 
					OR
					(f.post_type = 'community' AND EXISTS (
						SELECT 1
						FROM community_post c
						WHERE c.post_id = f.post_id
							AND (c.user_id = #{user_id} OR c.visibility = 'PUBLIC')
					)) -->
				)
		) THEN 1 ELSE 0 END AS allowed
		FROM dual
	</select>	
</mapper>